//
// RUN: gluc %s --print-gil | FileCheck -v %s --check-prefix=CHECK-GIL
//

struct Counter {
    value: Int
}

// Define a copy function that modifies the value
func copy(c: *Counter) -> Counter {
    var newCounter: Counter;
    newCounter.value = c.*.value + 1;
    return newCounter;
}

// CHECK-GIL: gil @copy
// CHECK-GIL: gil @testCopy

func testCopy(c: Counter) -> Int {
    var c2: Counter = c; // This should call the copy function
    // CHECK-GIL: copy
    return c2.value;
}

func main() -> Int {
    var c1: Counter;
    c1.value = 10;
    
    var result: Int = testCopy(c1);
    
    return result;
}

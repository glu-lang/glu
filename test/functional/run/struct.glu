//
// RUN: gluc %s -o %t && %t | FileCheck -v %s
// default values in structs are not resolved
//

@no_mangling func puts(s: *Char);

struct MyStruct {
    first: *Char = "firstDefault",
    second: *Char = "secondDefault"
}

struct MyContainer {
    content: MyStruct = {}
}

func testStruct(s: MyStruct) -> Void {
    puts(s.first);
    puts(s.second);
}

func main() -> Int {
    // CHECK: firstDefault
    // CHECK: secondDefault
    let default: MyStruct = {};
    testStruct(default);

    // CHECK: firstInit
    // CHECK: secondDefault
    let init: MyStruct = {"firstInit"};
    testStruct(init);

    // CHECK: secondInit
    // CHECK: thirdInit
    let secondInit: MyStruct = {"secondInit", "thirdInit"};
    testStruct(secondInit);

    let container: MyContainer = {};
    // CHECK: firstDefault
    // CHECK: secondDefault
    testStruct(container.content);

    let containerInit: MyContainer = { {"nestedInit"} };
    // CHECK: nestedInit
    // CHECK: secondDefault
    testStruct(containerInit.content);

    return 0;
}

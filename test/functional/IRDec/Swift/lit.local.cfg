# Local configuration for Swift IRDec tests
# Allow .swift files

import lit.util

config.suffixes.add('.swift')

# Mark unsupported if Swift is not available
# Mark unsupported if LLVM version is 19, as Swift uses a version based on LLVM19 but with extensions from LLVM 20
if not lit.util.which("swiftc", config.environment["PATH"]) or config.llvm_tools_version == '19':
  config.unsupported = True
else:
  # Find the clang that comes with Swift
  swift_dir = os.path.dirname(os.path.realpath(lit.util.which("swiftc", config.environment["PATH"])))
  config.substitutions.append(('swift-clang', swift_dir + '/clang'))
